# 005 - –§–ê–ó–ê 1: –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø - –°–û–ó–î–ê–ù–û

**–î–∞—Ç–∞:** 26.12.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

---

## ‚úÖ –ß–¢–û –ë–´–õ–û –°–û–ó–î–ê–ù–û

### Entity –∫–ª–∞—Å—Å—ã (–º–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `entity/User.kt` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø–æ–ª—è–º–∏: uuid, username, email, password, roles –∏ –¥—Ä. |
| `entity/Role.kt` | –†–æ–ª—å (ROLE_USER, ROLE_ADMIN, ROLE_MODERATOR) |
| `entity/RefreshToken.kt` | Refresh —Ç–æ–∫–µ–Ω –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è access token |

### Repository (—Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö)
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `repository/UserRepository.kt` | CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π + –ø–æ–∏—Å–∫ |
| `repository/RoleRepository.kt` | –†–∞–±–æ—Ç–∞ —Å —Ä–æ–ª—è–º–∏ |
| `repository/RefreshTokenRepository.kt` | –†–∞–±–æ—Ç–∞ —Å refresh —Ç–æ–∫–µ–Ω–∞–º–∏ |

### DTO (Data Transfer Objects)
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `dto/auth/AuthDto.kt` | RegisterRequest, LoginRequest, AuthResponse, RefreshTokenRequest |
| `dto/auth/UserDto.kt` | UserDto, UserSummaryDto, UpdateProfileRequest |

### Security (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `security/JwtService.kt` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤ |
| `security/UserPrincipal.kt` | –û–±—ë—Ä—Ç–∫–∞ User –¥–ª—è Spring Security |
| `security/CustomUserDetailsService.kt` | –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| `security/JwtAuthenticationFilter.kt` | –§–∏–ª—å—Ç—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ |

### Config (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `config/SecurityConfig.kt` | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Spring Security, CORS, JWT —Ñ–∏–ª—å—Ç—Ä |
| `config/JwtProperties.kt` | –°–≤–æ–π—Å—Ç–≤–∞ JWT –∏–∑ application.properties |
| `config/DataInitializer.kt` | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ä–æ–ª–∏, –∞–¥–º–∏–Ω) |

### Service (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `service/AuthService.kt` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, refresh —Ç–æ–∫–µ–Ω—ã, logout |

### Controller (REST API)
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `controller/AuthController.kt` | Endpoints: register, login, refresh, logout, me |

### Exception (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `exception/Exceptions.kt` | –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è (BadRequest, NotFound –∏ –¥—Ä.) |
| `exception/GlobalExceptionHandler.kt` | –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ |

---

## üîß –î–ï–ô–°–¢–í–ò–Ø –ö–û–¢–û–†–´–ï –ù–£–ñ–ù–û –í–´–ü–û–õ–ù–ò–¢–¨

### –®–ê–ì 1: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å Gradle –≤ IDEA

**–°–ø–æ—Å–æ–± 1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π):**
- –ù–∞–∂–º–∏ **Ctrl+Shift+O** (–∏–ª–∏ Cmd+Shift+O –Ω–∞ Mac)

**–°–ø–æ—Å–æ–± 2:**
- –ü—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –Ω–∞ `build.gradle.kts`
- –í—ã–±–µ—Ä–∏ **"Reload Gradle Project"**

**–°–ø–æ—Å–æ–± 3:**
- –°–ø—Ä–∞–≤–∞ –≤ IDEA –Ω–∞–π–¥–∏ –ø–∞–Ω–µ–ª—å **Gradle** (–∑–Ω–∞—á–æ–∫ —Å–ª–æ–Ω–∞)
- –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É **üîÑ Refresh** (–æ–±–Ω–æ–≤–∏—Ç—å)

### –®–ê–ì 2: –ü–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- IDEA —Å–∫–∞—á–∞–µ—Ç JWT –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (jjwt-api, jjwt-impl, jjwt-jackson)
- –í–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞ —É–≤–∏–¥–∏—à—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
- –ü–æ–¥–æ–∂–¥–∏ –ø–æ–∫–∞ –∏—Å—á–µ–∑–Ω–µ—Ç

### –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—à–∏–±–∫–∏ –∏—Å—á–µ–∑–ª–∏
- –û—Ç–∫—Ä–æ–π `JwtService.kt`
- –ö—Ä–∞—Å–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å
- Imports –¥–æ–ª–∂–Ω—ã –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç—å—Å—è

---

## üì° API ENDPOINTS (–≥–æ—Ç–æ–≤—ã–µ)

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏ —É —Ç–µ–±—è –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|-------|-----|----------|-------------|
| POST | `/api/auth/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚ùå –ù–µ—Ç |
| POST | `/api/auth/login` | –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É | ‚ùå –ù–µ—Ç |
| POST | `/api/auth/refresh` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ | ‚ùå –ù–µ—Ç |
| POST | `/api/auth/logout` | –í—ã—Ö–æ–¥ (–æ—Ç–∑—ã–≤ refresh token) | ‚ùå –ù–µ—Ç |
| POST | `/api/auth/logout-all` | –í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ | ‚úÖ –î–∞ |
| GET | `/api/auth/me` | –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ –î–∞ |

---

## üìù –ü–†–ò–ú–ï–†–´ –ó–ê–ü–†–û–°–û–í

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```json
POST /api/auth/register
{
    "username": "john_doe",
    "email": "john@example.com",
    "password": "Password123",
    "firstName": "John",
    "lastName": "Doe"
}
```

### –õ–æ–≥–∏–Ω
```json
POST /api/auth/login
{
    "usernameOrEmail": "john_doe",
    "password": "Password123"
}
```

### –û—Ç–≤–µ—Ç (AuthResponse)
```json
{
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "550e8400-e29b-41d4-a716-446655440000",
    "tokenType": "Bearer",
    "expiresIn": 86400,
    "user": {
        "uuid": "123e4567-e89b-12d3-a456-426614174000",
        "username": "john_doe",
        "email": "john@example.com",
        ...
    }
}
```

---

## üóÉÔ∏è –ë–ê–ó–ê –î–ê–ù–ù–´–•

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–¥—É—Ç—Å—è:

### –¢–∞–±–ª–∏—Ü—ã
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `roles` - —Ä–æ–ª–∏
- `user_roles` - —Å–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–æ–ª–µ–π
- `refresh_tokens` - refresh —Ç–æ–∫–µ–Ω—ã

### –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –†–æ–ª–∏: ROLE_USER, ROLE_ADMIN, ROLE_MODERATOR
- –ê–¥–º–∏–Ω: `admin` / `Admin123!`

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

–ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ Gradle –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –æ—à–∏–±–æ–∫:

1. **–ó–∞–ø—É—Å—Ç–∏ Docker:** `docker-compose up -d`
2. **–ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:** –∑–µ–ª—ë–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –≤ `IdentitySocialApplication.kt`
3. **–ü—Ä–æ–≤–µ—Ä—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:** http://localhost:8081
4. **–¢–µ—Å—Ç–∏—Ä—É–π —á–µ—Ä–µ–∑ Postman** –∏–ª–∏ curl

---

## üìä –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í

```
src/main/kotlin/com/tolegen/identitysocial/
‚îú‚îÄ‚îÄ IdentitySocialApplication.kt
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ DataInitializer.kt
‚îÇ   ‚îú‚îÄ‚îÄ JwtProperties.kt
‚îÇ   ‚îî‚îÄ‚îÄ SecurityConfig.kt
‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îî‚îÄ‚îÄ AuthController.kt
‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îî‚îÄ‚îÄ auth/
‚îÇ       ‚îú‚îÄ‚îÄ AuthDto.kt
‚îÇ       ‚îî‚îÄ‚îÄ UserDto.kt
‚îú‚îÄ‚îÄ entity/
‚îÇ   ‚îú‚îÄ‚îÄ RefreshToken.kt
‚îÇ   ‚îú‚îÄ‚îÄ Role.kt
‚îÇ   ‚îî‚îÄ‚îÄ User.kt
‚îú‚îÄ‚îÄ exception/
‚îÇ   ‚îú‚îÄ‚îÄ Exceptions.kt
‚îÇ   ‚îî‚îÄ‚îÄ GlobalExceptionHandler.kt
‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îú‚îÄ‚îÄ RefreshTokenRepository.kt
‚îÇ   ‚îú‚îÄ‚îÄ RoleRepository.kt
‚îÇ   ‚îî‚îÄ‚îÄ UserRepository.kt
‚îú‚îÄ‚îÄ security/
‚îÇ   ‚îú‚îÄ‚îÄ CustomUserDetailsService.kt
‚îÇ   ‚îú‚îÄ‚îÄ JwtAuthenticationFilter.kt
‚îÇ   ‚îú‚îÄ‚îÄ JwtService.kt
‚îÇ   ‚îî‚îÄ‚îÄ UserPrincipal.kt
‚îî‚îÄ‚îÄ service/
    ‚îî‚îÄ‚îÄ AuthService.kt
```

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 26.12.2025*

